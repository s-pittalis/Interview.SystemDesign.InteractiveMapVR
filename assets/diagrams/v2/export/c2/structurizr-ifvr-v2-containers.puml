@startuml
title <size:24>Container View: Interactive Map VR System</size>

set separator none
left to right direction
skinparam ranksep 60
skinparam nodesep 30
hide stereotype

<style>
  root {
    BackgroundColor: #ffffff;
    FontColor: #444444;
  }
  // Element
  .Element-RWxlbWVudA== {
    BackgroundColor: #ffffff;
    LineColor: #444444;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #444444;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Relationship
  .Relationship-UmVsYXRpb25zaGlw {
    LineThickness: 2;
    LineStyle: 10-10;
    LineColor: #444444;
    FontColor: #444444;
    FontSize: 24;
  }
  // Interactive Map VR System
  .Boundary-SW50ZXJhY3RpdmUgTWFwIFZSIFN5c3RlbQ== {
    BackgroundColor: #ffffff;
    LineColor: #444444;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #444444;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
</style>

rectangle "==VR User\n<size:16>[Person]</size>\n\nOperatore che utilizza Meta Quest 3." <<Element-RWxlbWVudA==>> as VRUser
rectangle "==Meta Shared Spatial Anchors\n<size:16>[Software System]</size>\n\nServizio cloud per ancore spaziali condivise." <<Element-RWxlbWVudA==>> as MetaSharedSpatialAnchors
rectangle "==Maps Service\n<size:16>[Software System]</size>\n\nMapTiler / Maps3D.io" <<Element-RWxlbWVudA==>> as MapsService

rectangle "Interactive Map VR System\n<size:16>[Software System]</size>" <<Boundary-SW50ZXJhY3RpdmUgTWFwIFZSIFN5c3RlbQ==>> {
  rectangle "==Photon Fusion Server\n<size:16>[Container: Gestisce le room e mantiene lo stato runtime autorevole (UDP/TCP 5055).]</size>\n\nPhoton Fusion" <<Element-RWxlbWVudA==>> as InteractiveMapVRSystem.PhotonFusionServer
  rectangle "==Backend (FastAPI)\n<size:16>[Container: Legge lo stato delle room direttamente da Photon Server e gestisce autenticazione, persistenza e snapshot.]</size>\n\nPython 3.x" <<Element-RWxlbWVudA==>> as InteractiveMapVRSystem.BackendFastAPI
  rectangle "==PostgreSQL\n<size:16>[Container: Utenti, sessioni, snapshot JSONB, vista save_index.]</size>\n\nPostgreSQL 13+" <<Element-RWxlbWVudA==>> as InteractiveMapVRSystem.PostgreSQL
  rectangle "==Observability Stack\n<size:16>[Container: Esporta metriche e dashboard locali.]</size>\n\nPrometheus + Grafana" <<Element-RWxlbWVudA==>> as InteractiveMapVRSystem.ObservabilityStack
  rectangle "==VPN Gateway\n<size:16>[Container: Consente accesso amministrativo remoto controllato all’edge node.]</size>\n\nWireGuard / OpenVPN" <<Element-RWxlbWVudA==>> as InteractiveMapVRSystem.VPNGateway
  rectangle "==Unity Client (Quest)\n<size:16>[Container: Esegue la scena VR e si connette al Photon Server via LAN.]</size>\n\nUnity + Meta XR + Fusion" <<Element-RWxlbWVudA==>> as InteractiveMapVRSystem.UnityClientQuest
}

VRUser --> InteractiveMapVRSystem.UnityClientQuest <<Relationship-UmVsYXRpb25zaGlw>> : "Usa l’applicazione VR"
InteractiveMapVRSystem.UnityClientQuest --> InteractiveMapVRSystem.PhotonFusionServer <<Relationship-UmVsYXRpb25zaGlw>> : "Sincronizzazione runtime (UDP/TCP)"
InteractiveMapVRSystem.UnityClientQuest --> InteractiveMapVRSystem.BackendFastAPI <<Relationship-UmVsYXRpb25zaGlw>> : "REST: login, sessioni (LAN)"
InteractiveMapVRSystem.UnityClientQuest --> MapsService <<Relationship-UmVsYXRpb25zaGlw>> : "HTTP(S): tile e asset 3D"
InteractiveMapVRSystem.UnityClientQuest --> MetaSharedSpatialAnchors <<Relationship-UmVsYXRpb25zaGlw>> : "Crea/ripristina ancore"
InteractiveMapVRSystem.BackendFastAPI --> InteractiveMapVRSystem.PhotonFusionServer <<Relationship-UmVsYXRpb25zaGlw>> : "Legge stato delle room per snapshot e autosave"
InteractiveMapVRSystem.PhotonFusionServer --> InteractiveMapVRSystem.BackendFastAPI <<Relationship-UmVsYXRpb25zaGlw>> : "Eventi webhook e accesso condiviso allo stato runtime"
InteractiveMapVRSystem.BackendFastAPI --> InteractiveMapVRSystem.PostgreSQL <<Relationship-UmVsYXRpb25zaGlw>> : "Scrive snapshot e metadati"
InteractiveMapVRSystem.BackendFastAPI --> InteractiveMapVRSystem.ObservabilityStack <<Relationship-UmVsYXRpb25zaGlw>> : "/metrics, log strutturati"
InteractiveMapVRSystem.VPNGateway --> InteractiveMapVRSystem.BackendFastAPI <<Relationship-UmVsYXRpb25zaGlw>> : "Accesso remoto e manutenzione"

@enduml